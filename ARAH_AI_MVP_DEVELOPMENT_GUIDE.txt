================================================================================
                     ARAH.AI â€” MVP DEVELOPMENT GUIDE
              Panduan Lengkap untuk Tim Developer (v1.0)
              Tanggal: 18 Februari 2026
================================================================================

DAFTAR ISI:
  1. APA ITU ARAH.AI?
  2. SIAPA YANG AKAN PAKAI?
  3. KONDISI CODEBASE SAAT INI
  4. ARSITEKTUR SISTEM YANG DITUJU
  5. DUA MODE UTAMA: CHATBOT & PLANNER
  6. TIGA MASALAH PENTING YANG HARUS DIPAHAMI
  7. ENAM FITUR MVP â€” PENJELASAN LENGKAP
  8. ALUR USER (USER FLOW) â€” STEP BY STEP
  9. APA YANG HARUS DIKERJAKAN (TASK BREAKDOWN)
 10. DETAIL TEKNIS PER TASK
 11. FILE-FILE YANG PERLU DIUBAH
 12. CONTOH KODE & PSEUDOCODE
 13. TESTING & VALIDASI
 14. HAL YANG TIDAK PERLU DIKERJAKAN (OUT OF SCOPE)
 15. GLOSARIUM (ISTILAH-ISTILAH)

================================================================================
1. APA ITU ARAH.AI?
================================================================================

arah.ai adalah AI asisten akademik untuk mahasiswa perguruan tinggi.

Tujuan MVP ini:
- Deploy secara PUBLIK dan GRATIS
- Siapa saja bisa mencoba (mahasiswa dari kampus mana pun)
- Tujuan utama: MARKETING â€” bikin orang tertarik dan bilang "ini berguna"
- Bukan product final, tapi demo yang fungsional dan impresif

Apa yang bisa dilakukan arah.ai:
- Menjawab pertanyaan tentang perkuliahan dan pendidikan tinggi
- Membaca dokumen akademik yang di-upload mahasiswa
- Menyusun rencana perkuliahan (jadwal, rekomendasi mata kuliah, dll)
- Menghitung nilai yang dibutuhkan untuk lulus/perbaikan
- Memberikan saran berdasarkan target karir mahasiswa

================================================================================
2. SIAPA YANG AKAN PAKAI?
================================================================================

TARGET: Mahasiswa aktif dari kampus MANA PUN di Indonesia.

Implikasi penting:
- Sistem harus GENERAL, tidak terikat ke kampus tertentu
- Data akademik tiap kampus BERBEDA formatnya
- Tidak semua mahasiswa punya dokumen akademik lengkap
- Sistem harus tetap berguna WALAU data tidak lengkap

================================================================================
3. KONDISI CODEBASE SAAT INI
================================================================================

Kita sudah punya codebase bernama "academic_rag_project" yang menjadi fondasi.
Repository: https://github.com/Afyuadriputra/academic_rag_project

3.1 TECH STACK YANG SUDAH ADA
-------------------------------

Backend:
  - Django 6.0.1 (Python web framework)
  - Django REST Framework (untuk API)
  - ChromaDB (vector database â€” menyimpan embedding dokumen)
  - LangChain (orchestration untuk RAG)
  - HuggingFace Embeddings model: all-MiniLM-L6-v2
  - OpenRouter API (untuk akses LLM â€” model AI bahasa)
  - Inertia.js (penghubung Django â†” React)
  - SQLite (database relasional)

Frontend:
  - React 19 + TypeScript
  - Vite (build tool)
  - TailwindCSS 4 (styling)
  - Framer Motion (animasi)
  - Radix UI (komponen UI)
  - Axios (HTTP client)

3.2 FITUR YANG SUDAH JALAN
----------------------------

  âœ… User registration & login (session-based auth)
  âœ… Upload dokumen (PDF, Excel, CSV, MD, TXT)
  âœ… Document parsing & embedding ke ChromaDB
  âœ… Chat dengan AI (RAG â€” jawab berdasarkan dokumen yang di-upload)
  âœ… Multi-session chat (bisa buat beberapa percakapan)
  âœ… Knowledge base sidebar (daftar dokumen yang di-upload)
  âœ… Storage quota management (limit 10MB per user)
  âœ… Rate limiting login (django-axes)
  âœ… Audit logging

3.3 STRUKTUR FOLDER PENTING
-----------------------------

  academic_rag_project/
  â”œâ”€â”€ config/
  â”‚   â”œâ”€â”€ settings.py          â† Konfigurasi Django (database, middleware, dll)
  â”‚   â”œâ”€â”€ urls.py              â† Root routing
  â”‚   â””â”€â”€ logging_filters.py   â† Custom logging
  â”‚
  â”œâ”€â”€ core/
  â”‚   â”œâ”€â”€ models.py            â† Data models (AcademicDocument, ChatSession, dll)
  â”‚   â”œâ”€â”€ views.py             â† API endpoints (HTTP handling)
  â”‚   â”œâ”€â”€ service.py           â† Business logic (SEMUA logika bisnis di sini)
  â”‚   â”œâ”€â”€ urls.py              â† App routing (daftar semua API endpoints)
  â”‚   â”œâ”€â”€ middleware.py        â† Request context & access logging
  â”‚   â”œâ”€â”€ admin.py             â† Django admin registration
  â”‚   â”‚
  â”‚   â””â”€â”€ ai_engine/           â† Otak AI sistem
  â”‚       â”œâ”€â”€ config.py        â† Setup ChromaDB + embedding model
  â”‚       â”œâ”€â”€ ingest.py        â† Proses dokumen â†’ parsing â†’ embedding
  â”‚       â”œâ”€â”€ vector_ops.py    â† Operasi CRUD di vector database
  â”‚       â””â”€â”€ retrieval/       â† Logika RAG (cari dokumen + jawab pertanyaan)
  â”‚           â”œâ”€â”€ main.py      â† Fungsi utama: ask_bot()
  â”‚           â”œâ”€â”€ llm.py       â† Konfigurasi LLM (model AI + fallback)
  â”‚           â”œâ”€â”€ prompt.py    â† Template prompt untuk AI
  â”‚           â”œâ”€â”€ rules.py     â† Deteksi tipe query (jadwal/transkrip/umum)
  â”‚           â””â”€â”€ utils.py     â† Helper functions
  â”‚
  â”œâ”€â”€ frontend/
  â”‚   â”œâ”€â”€ src/
  â”‚   â”‚   â”œâ”€â”€ main.tsx         â† Entry point React + Inertia bootstrap
  â”‚   â”‚   â”œâ”€â”€ pages/
  â”‚   â”‚   â”‚   â”œâ”€â”€ Auth/Login.tsx      â† Halaman login
  â”‚   â”‚   â”‚   â”œâ”€â”€ Auth/Register.tsx   â† Halaman register
  â”‚   â”‚   â”‚   â””â”€â”€ Chat/Index.tsx      â† Halaman utama chat (PALING PENTING)
  â”‚   â”‚   â”œâ”€â”€ lib/
  â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts       â† Semua fungsi API call ke backend
  â”‚   â”‚   â”‚   â””â”€â”€ utils.ts     â† Utility functions
  â”‚   â”‚   â””â”€â”€ components/
  â”‚   â”‚       â”œâ”€â”€ organisms/   â† Komponen besar (AppHeader, ChatThread, dll)
  â”‚   â”‚       â”œâ”€â”€ molecules/   â† Komponen sedang (ChatBubble, ChatComposer, dll)
  â”‚   â”‚       â””â”€â”€ atoms/       â† Komponen kecil (Avatar, Badge, dll)
  â”‚   â””â”€â”€ package.json         â† Dependencies frontend
  â”‚
  â””â”€â”€ manage.py                â† Django management command

3.4 POLA ARSITEKTUR YANG SUDAH ADA (WAJIB DIIKUTI)
-----------------------------------------------------

Sistem ini sudah punya pola yang jelas. JANGAN ubah pola ini:

  VIEWS (views.py)
    â†’ Hanya handle HTTP: parse request, validasi, kirim response
    â†’ TIDAK boleh ada logika bisnis di sini
    â†’ Contoh: parse JSON, cek authentication, return JsonResponse

  SERVICE (service.py)
    â†’ SEMUA logika bisnis ada di sini
    â†’ Fungsi-fungsi pure (tidak tahu tentang HTTP)
    â†’ Bisa dipanggil dan di-test tanpa web server
    â†’ Contoh: upload_files_batch(), chat_and_save(), get_dashboard_props()

  AI ENGINE (ai_engine/)
    â†’ Khusus untuk hal-hal AI: embedding, retrieval, prompting
    â†’ Dipanggil oleh service.py, BUKAN langsung oleh views.py

  MODELS (models.py)
    â†’ Definisi struktur data (tabel database)
    â†’ Tidak ada logika bisnis di models

  Alur request:  User â†’ URL â†’ views.py â†’ service.py â†’ ai_engine/ â†’ response

3.5 API ENDPOINTS YANG SUDAH ADA
----------------------------------

  POST   /api/chat/                â† Kirim pesan chat, terima jawaban AI
  POST   /api/upload/              â† Upload dokumen (batch)
  GET    /api/documents/           â† Daftar dokumen + info storage
  DELETE /api/documents/<id>/      â† Hapus dokumen
  GET    /api/sessions/            â† Daftar chat sessions
  POST   /api/sessions/            â† Buat session baru
  GET    /api/sessions/<id>/       â† History chat dalam session
  PATCH  /api/sessions/<id>/       â† Rename session
  DELETE /api/sessions/<id>/       â† Hapus session
  POST   /api/reingest/            â† Re-embed dokumen

3.6 CARA AI MENJAWAB PERTANYAAN (SEKARANG)
--------------------------------------------

  1. User kirim pesan via POST /api/chat/
  2. views.py terima â†’ panggil service.chat_and_save()
  3. service.py panggil ask_bot(user_id, query)
  4. ask_bot() di retrieval/main.py:
     a. Cari dokumen relevan di ChromaDB (filter by user_id)
     b. Ambil top-20 dokumen mirip
     c. Kirim ke LLM dengan prompt template
     d. LLM generate jawaban berdasarkan konteks
     e. Return {answer, sources}
  5. Jawaban disimpan ke ChatHistory
  6. Dikirim ke frontend sebagai JSON

  LLM yang dipakai: OpenRouter API (model gratis)
  Fallback: Kalau model pertama gagal, otomatis coba model berikutnya
  Model saat ini: qwen3, nemotron, trinity, llama-3.3

3.7 PROMPT SAAT INI
---------------------

  File: core/ai_engine/retrieval/prompt.py

  Prompt sekarang SANGAT SEDERHANA â€” hanya bilang:
  "Anda adalah asisten akademik. Jawab pertanyaan berdasarkan konteks."

  Format output wajib:
  ## Ringkasan
  ## Tabel
  ## Insight Singkat
  ## Pertanyaan Lanjutan
  ## Opsi Cepat

  MASALAH: Prompt ini terlalu generic. AI tidak tahu cara menyusun jadwal,
  menghitung nilai, atau memberikan rekomendasi mata kuliah secara terstruktur.

================================================================================
4. ARSITEKTUR SISTEM YANG DITUJU
================================================================================

Sistem akan punya SATU TAMPILAN UTAMA (halaman chat) dengan DUA MODE:

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  arah.ai                                    â”‚
  â”‚                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
  â”‚  â”‚ ğŸ’¬ Chat  â”‚   â”‚ ğŸ“‹ Plan  â”‚  â† toggle     â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
  â”‚                                              â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚                                      â”‚   â”‚
  â”‚  â”‚    Area chat (sama untuk kedua mode) â”‚   â”‚
  â”‚  â”‚                                      â”‚   â”‚
  â”‚  â”‚    Mode Chat: tanya jawab bebas      â”‚   â”‚
  â”‚  â”‚    Mode Plan: wizard step-by-step    â”‚   â”‚
  â”‚  â”‚                                      â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚  ğŸ“  Ketik pesan...          Kirim â–¶ â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PENTING:
- Kedua mode berada di HALAMAN YANG SAMA
- Hanya switch dengan tombol toggle (seperti ChatGPT biasa vs Deep Research)
- Area chat SAMA â€” pesan muncul di thread yang sama
- Data (dokumen yang di-upload) SHARED antara kedua mode
- Upload dokumen bisa dilakukan LANGSUNG di chat (tombol ğŸ“ atau drag & drop)

================================================================================
5. DUA MODE UTAMA: CHATBOT & PLANNER
================================================================================

5.1 MODE CHATBOT (ğŸ’¬)
-----------------------

Apa ini:
  - Tanya jawab BEBAS tentang pendidikan tinggi dan perkuliahan
  - Ini tampilan DEFAULT yang dilihat user pertama kali
  - Seperti ChatGPT tapi khusus akademik

Apa yang bisa dilakukan:
  - Jawab pertanyaan umum: "Apa itu SKS?", "Bagaimana cara menghitung IPK?"
  - Jawab berdasarkan dokumen yang di-upload: "Jadwal kuliah saya hari Senin apa?"
  - Upload dokumen langsung di chat
  - Tetap berguna TANPA upload dokumen (jawab dari pengetahuan umum)

Apa yang perlu dikerjakan:
  - Perkuat prompt agar lebih pintar soal akademik
  - Tambah kemampuan adaptif (lihat Section 6 â€” Tiga Masalah)

Secara teknis:
  - Ini SUDAH ADA di codebase sekarang
  - Yang berubah: prompt di prompt.py menjadi lebih cerdas
  - Endpoint tetap: POST /api/chat/

5.2 MODE PLANNER (ğŸ“‹)
-----------------------

Apa ini:
  - Fitur perencanaan perkuliahan dengan panduan step-by-step
  - Semua 6 fitur MVP ada di sini
  - AI memandu user lewat pertanyaan-pertanyaan, kasih opsi bernomor
  - Di akhir, AI generate rencana perkuliahan lengkap

Cara kerjanya:
  - User klik tombol "ğŸ“‹ Plan"
  - AI mulai bertanya step by step DI DALAM CHAT (bukan halaman baru)
  - Setiap pertanyaan punya opsi bernomor yang bisa dipilih
  - User bisa juga ketik jawaban custom
  - Setelah data terkumpul, AI generate rencana lengkap
  - User bisa minta revisi atau opsi alternatif

CONTOH ALUR PLANNER (ini yang muncul di area chat):

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ AI: Halo! Mari susun rencana perkuliahanmu ğŸ“‹      â”‚
  â”‚                                                    â”‚
  â”‚     Pertama, apakah kamu punya dokumen akademik?   â”‚
  â”‚                                                    â”‚
  â”‚     1. ğŸ“ Ya, saya mau upload file                 â”‚
  â”‚     2. âœï¸ Tidak, saya isi manual saja               â”‚
  â”‚     3. ğŸ¤· Saya tidak yakin apa yang diperlukan      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User pilih: 2

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ AI: Tidak masalah! Saya bantu step by step.        â”‚
  â”‚                                                    â”‚
  â”‚     Jurusan kamu apa?                              â”‚
  â”‚                                                    â”‚
  â”‚     1. Teknik Informatika                          â”‚
  â”‚     2. Sistem Informasi                            â”‚
  â”‚     3. Manajemen                                   â”‚
  â”‚     4. Akuntansi                                   â”‚
  â”‚     5. Hukum                                       â”‚
  â”‚     6. âœï¸ Ketik sendiri                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User pilih: 1

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ AI: Semester berapa sekarang?                      â”‚
  â”‚                                                    â”‚
  â”‚     1. Semester 1-2 (awal)                         â”‚
  â”‚     2. Semester 3-4 (tengah)                       â”‚
  â”‚     3. Semester 5-6 (atas)                         â”‚
  â”‚     4. Semester 7+ (akhir)                         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User pilih: 3

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ AI: Apa tujuan utamamu semester ini?               â”‚
  â”‚                                                    â”‚
  â”‚     1. ğŸš€ Lulus cepat (ambil SKS maksimal)         â”‚
  â”‚     2. ğŸ“ˆ IPK tinggi (pilih yang bisa dapat A)     â”‚
  â”‚     3. âš–ï¸ Seimbang (kuliah + kehidupan)            â”‚
  â”‚     4. ğŸ’¼ Fokus karir tertentu                     â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User pilih: 4

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ AI: Karir apa yang kamu targetkan?                 â”‚
  â”‚                                                    â”‚
  â”‚     1. ğŸ’» Software Engineer                        â”‚
  â”‚     2. ğŸ“Š Data Scientist / Analyst                 â”‚
  â”‚     3. ğŸ”’ Cybersecurity Specialist                 â”‚
  â”‚     4. ğŸ“± Mobile Developer                         â”‚
  â”‚     5. ğŸ® Game Developer                           â”‚
  â”‚     6. âœï¸ Ketik sendiri                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  User pilih: 2

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ AI: Preferensi jadwal?                             â”‚
  â”‚                                                    â”‚
  â”‚     1. ğŸŒ… Pagi (08:00-12:00)                       â”‚
  â”‚     2. â˜€ï¸ Siang-sore (12:00-17:00)                 â”‚
  â”‚     3. ğŸ”„ Fleksibel                                â”‚
  â”‚                                                    â”‚
  â”‚     Ada hari yang ingin dikosongkan?               â”‚
  â”‚     1. Jumat libur                                 â”‚
  â”‚     2. Sabtu libur                                 â”‚
  â”‚     3. Tidak ada preferensi                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ... dan seterusnya sampai data cukup.

  Lalu AI GENERATE RENCANA LENGKAP (lihat Section 8 untuk contoh output).

Secara teknis â€” yang perlu dibangun:
  - Backend: Planner state machine (track user ada di step mana)
  - Backend: Prompt khusus per step
  - Backend: Endpoint baru POST /api/planner/ (atau extend /api/chat/)
  - Frontend: Render opsi bernomor sebagai tombol yang bisa diklik
  - Frontend: Toggle Chat â†” Plan

================================================================================
6. TIGA MASALAH PENTING YANG HARUS DIPAHAMI
================================================================================

Ini adalah CONSTRAINT utama yang menentukan keberhasilan MVP.
Setiap keputusan desain harus mempertimbangkan ketiga masalah ini.

MASALAH 1: TIDAK SEMUA MAHASISWA PUNYA DATA
---------------------------------------------

Realita:
  - Ada yang punya transkrip PDF lengkap â†’ bagus
  - Ada yang cuma punya foto jadwal dari WhatsApp â†’ parsial
  - Ada yang cuma ingat "saya semester 5, jurusan Informatika" â†’ minimal
  - Ada yang tidak punya apa-apa â†’ zero data

Solusi: SISTEM BERLAPIS (Graceful Degradation)

  Level 3 (data lengkap):
    User upload transkrip + jadwal induk + kurikulum
    â†’ AI bisa jawab SEMUA pertanyaan dengan akurat
    â†’ Planner generate rencana paling lengkap

  Level 2 (data sebagian):
    User upload sebagian (misal cuma jadwal)
    â†’ AI bantu sesuai data yang ada
    â†’ Planner generate rencana parsial + sarankan "upload juga transkrip"

  Level 1 (data dari chat):
    User tidak upload tapi ceritakan info lewat chat
    â†’ AI kumpulkan info dari percakapan
    â†’ Planner tanya step-by-step, gunakan jawaban user

  Level 0 (tidak ada data):
    User baru masuk, belum apa-apa
    â†’ Chatbot tetap bisa jawab pertanyaan umum
    â†’ Planner guide user untuk memberikan info minimal

  ATURAN EMAS: AI TIDAK BOLEH MENOLAK.
  AI harus SELALU membantu, sebisa mungkin, dengan data yang ada.
  Kalau data kurang, AI TANYA BALIK â€” bukan bilang "upload dulu".


MASALAH 2: FORMAT DATA BERBEDA TIAP KAMPUS
--------------------------------------------

Realita:
  - Transkrip UI berbeda format dari UGM, berbeda dari Binus
  - Ada yang pakai nilai huruf (A/B/C), ada angka (0-100), ada skala 4.0
  - Jadwal induk tiap kampus tata letaknya beda
  - Bahasa bisa Indonesia atau Inggris

Solusi: AI YANG FLEKSIBEL, BUKAN PARSER YANG KAKU

  JANGAN hard-code format tertentu.
  JANGAN expect kolom harus bernama persis "Mata Kuliah" atau "Kode MK".

  Sebaliknya:
  - Prompt AI untuk MENGENALI POLA: "Kalau ada tabel dengan kolom nilai,
    itu kemungkinan transkrip"
  - Sistem ingest yang sudah ada punya header normalization (_HEADER_MAP di
    ingest.py) â€” ini sudah cukup bagus, tapi perlu diperluas
  - Setelah AI baca dokumen, SELALU KONFIRMASI:
    "Saya menemukan 12 mata kuliah di transkrip Anda. IPK 3.2. Benar?"
  - Kalau salah, user bisa koreksi lewat chat


MASALAH 3: HARUS TETAP BERGUNA WALAU DATA TERBATAS
-----------------------------------------------------

Ini yang paling penting untuk MARKETING MVP.

  AI yang buruk âŒ                  AI arah.ai âœ…
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  "Upload dokumen dulu"            "Hai! Ceritakan jurusan dan semester
                                    kamu, saya bantu sebisa mungkin"

  "Saya butuh transkrip juga"      "Dari jadwal Anda, saya lihat ada 6
                                    mata kuliah. Mau saya analisis beban
                                    belajarnya?"

  "Data tidak tersedia"            "Berapa nilai UTS dan bobotnya? Saya
                                    hitung berapa yang Anda butuhkan"

  "File tidak didukung"            "Saya tangkap beberapa info dari
                                    file ini. Coba ceritakan isinya?"

  PRINSIP: Selalu tawarkan ALTERNATIF, jangan pernah dead-end.

  Untuk Planner khususnya:
  - Output harus punya DISCLAIMER kalau data tidak lengkap
  - Contoh: "âš ï¸ Rencana ini berdasarkan info yang Anda berikan.
    Cocokkan dengan jadwal resmi kampus Anda."
  - AI PROAKTIF sarankan data apa yang perlu dilengkapi

TENTANG JADWAL INDUK (PENTING!):
  Jadwal Induk = daftar SEMUA kelas yang ditawarkan kampus per semester
  (mata kuliah, kelas, jam, ruang, dosen, kuota).

  Ini data kunci untuk fitur Automated Scheduler.
  MASALAHNYA: Tidak semua kampus memberikan ini ke mahasiswa.

  Solusi untuk MVP:
  - Kalau user PUNYA jadwal induk â†’ upload â†’ AI baca â†’ scheduling optimal
  - Kalau user TIDAK PUNYA â†’ AI tetap bisa:
    a. Tanya via chat: "Mata kuliah apa saja yang tersedia semester ini?"
    b. User sebut yang dia tahu
    c. AI susun rencana dari info yang ada
    d. Output + disclaimer: "Rencana ini berdasarkan info parsial"

================================================================================
7. ENAM FITUR MVP â€” PENJELASAN LENGKAP
================================================================================

Semua fitur ini ada di MODE PLANNER.
(Mode Chatbot tetap tanya-jawab bebas, bukan fitur-fitur ini)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FITUR 1: AUTOMATED SCHEDULER                                   â”‚
â”‚  "Susun jadwal kuliah otomatis tanpa bentrok"                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Apa yang dilakukan:                                             â”‚
â”‚  - Menyusun jadwal kuliah satu semester                          â”‚
â”‚  - Memastikan tidak ada bentrok waktu                            â”‚
â”‚  - Memenuhi kuota SKS                                            â”‚
â”‚  - Menyesuaikan dengan preferensi user                           â”‚
â”‚                                                                  â”‚
â”‚  Cara kerja di MVP:                                              â”‚
â”‚  - Jika ada jadwal induk â†’ AI baca dan susun kombinasi           â”‚
â”‚  - Jika tidak ada â†’ AI tanya mata kuliah + jam yang tersedia     â”‚
â”‚  - AI generate jadwal dalam format tabel                         â”‚
â”‚                                                                  â”‚
â”‚  Implementasi:                                                   â”‚
â”‚  - PROMPT-BASED (bukan algoritma)                                â”‚
â”‚  - Prompt instruksikan AI: "Susun jadwal dari data berikut,      â”‚
â”‚    pastikan tidak ada bentrok waktu, maksimal X SKS"             â”‚
â”‚  - Untuk MVP ini cukup â€” production nanti pakai algoritma        â”‚
â”‚                                                                  â”‚
â”‚  Trade-off MVP:                                                  â”‚
â”‚  - AI mungkin TIDAK menemukan solusi optimal dari ribuan          â”‚
â”‚    kombinasi, tapi untuk demo marketing ini acceptable            â”‚
â”‚  - Disclaimer: "Jadwal ini disusun berdasarkan data yang         â”‚
â”‚    Anda berikan. Silakan verifikasi kembali."                    â”‚
â”‚                                                                  â”‚
â”‚  Contoh output:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Hari â”‚ Mata Kuliah      â”‚ Jam       â”‚ SKS â”‚                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚  â”‚ Sen  â”‚ Machine Learning â”‚ 08:00-10  â”‚ 3   â”‚                   â”‚
â”‚  â”‚ Sen  â”‚ Basis Data II    â”‚ 13:00-15  â”‚ 3   â”‚                   â”‚
â”‚  â”‚ Sel  â”‚ Statistika       â”‚ 10:00-12  â”‚ 3   â”‚                   â”‚
â”‚  â”‚ Sel  â”‚ Kalkulus III     â”‚ 13:00-15  â”‚ 3   â”‚                   â”‚
â”‚  â”‚ Rab  â”‚ Jarkom           â”‚ 08:00-10  â”‚ 3   â”‚                   â”‚
â”‚  â”‚ Rab  â”‚ PBO              â”‚ 13:00-15  â”‚ 3   â”‚                   â”‚
â”‚  â”‚ Kam  â”‚ Bahasa Inggris   â”‚ 10:00-12  â”‚ 2   â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  Total: 20 SKS | 4 hari aktif | Jumat libur âœ…                   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FITUR 2: COURSE RECOMMENDATION                                 â”‚
â”‚  "Saran mata kuliah berdasarkan transkrip & prasyarat"           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Apa yang dilakukan:                                             â”‚
â”‚  - Analisis mata kuliah yang sudah diambil                       â”‚
â”‚  - Identifikasi mata kuliah yang BOLEH diambil (prasyarat met)   â”‚
â”‚  - Prioritaskan yang paling relevan untuk semester ini            â”‚
â”‚                                                                  â”‚
â”‚  Cara kerja di MVP:                                              â”‚
â”‚  - Jika ada transkrip â†’ AI baca dan analisis                     â”‚
â”‚  - Jika tidak â†’ AI tanya: "Mata kuliah apa yang sudah Anda       â”‚
â”‚    ambil? Nilai apa?"                                            â”‚
â”‚  - AI cocokkan dengan kurikulum umum jurusan tersebut            â”‚
â”‚                                                                  â”‚
â”‚  Implementasi:                                                   â”‚
â”‚  - PROMPT-BASED + RAG                                            â”‚
â”‚  - Prompt: "Berdasarkan transkrip berikut, rekomendasikan        â”‚
â”‚    mata kuliah untuk semester depan. Perhatikan prasyarat."       â”‚
â”‚  - RAG menyediakan konteks dari dokumen kurikulum (jika ada)     â”‚
â”‚                                                                  â”‚
â”‚  Contoh output:                                                  â”‚
â”‚  ğŸ¯ Rekomendasi Mata Kuliah Semester 5:                          â”‚
â”‚  â€¢ Machine Learning (wajib, prasyarat: Statistika âœ…)             â”‚
â”‚  â€¢ Data Mining (pilihan, mendukung karir Data Scientist)         â”‚
â”‚  â€¢ Basis Data II (wajib, prasyarat: Basis Data I âœ…)              â”‚
â”‚  âŒ Kecerdasan Buatan (prasyarat belum terpenuhi: Kalkulus III)   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FITUR 3: CAREER ALIGNMENT                                      â”‚
â”‚  "Pemetaan mata kuliah ke target karir"                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Apa yang dilakukan:                                             â”‚
â”‚  - User pilih target karir (Data Scientist, Software Engineer)   â”‚
â”‚  - AI prioritaskan mata kuliah pilihan yang mendukung karir      â”‚
â”‚  - Kasih rating relevansi per mata kuliah                        â”‚
â”‚                                                                  â”‚
â”‚  Cara kerja di MVP:                                              â”‚
â”‚  - PURE PROMPT-BASED â€” ini cocok untuk AI karena                 â”‚
â”‚    semantic matching (mencocokkan makna, bukan hitungan)          â”‚
â”‚  - AI sudah "tahu" mata kuliah mana yang relevan untuk karir     â”‚
â”‚    tertentu berdasarkan pengetahuan umumnya                      â”‚
â”‚                                                                  â”‚
â”‚  Implementasi:                                                   â”‚
â”‚  - Prompt: "User ingin menjadi {karir}. Dari mata kuliah         â”‚
â”‚    yang tersedia, prioritaskan yang mendukung karir tersebut.    â”‚
â”‚    Beri rating relevansi â˜…."                                     â”‚
â”‚                                                                  â”‚
â”‚  Contoh output:                                                  â”‚
â”‚  ğŸ’¼ Keselarasan Karir â€” Data Scientist:                          â”‚
â”‚  â€¢ Machine Learning    â˜…â˜…â˜… (sangat relevan â€” core skill)         â”‚
â”‚  â€¢ Statistika          â˜…â˜…â˜… (sangat relevan â€” fundamental)        â”‚
â”‚  â€¢ Data Mining         â˜…â˜…â˜† (relevan â€” complementary skill)       â”‚
â”‚  â€¢ Basis Data II       â˜…â˜…â˜† (relevan â€” data management)           â”‚
â”‚  â€¢ Bahasa Inggris      â˜…â˜†â˜† (supporting â€” publication & docs)     â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FITUR 4: COGNITIVE LOAD BALANCING                               â”‚
â”‚  "Distribusi mata kuliah berat secara merata"                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Apa yang dilakukan:                                             â”‚
â”‚  - Sebar mata kuliah berat (SKS tinggi, sulit) merata per hari   â”‚
â”‚  - Hindari hari yang terlalu padat                               â”‚
â”‚  - Sesuaikan dengan preferensi waktu user                        â”‚
â”‚                                                                  â”‚
â”‚  Cara kerja di MVP:                                              â”‚
â”‚  - Ini BAGIAN dari output scheduling                             â”‚
â”‚  - Bukan fitur terpisah, tapi aspek dari cara AI menyusun jadwal â”‚
â”‚  - Prompt instruksikan: "Sebar mata kuliah berat merata.         â”‚
â”‚    Jangan jadwalkan lebih dari 4 jam berturut-turut."            â”‚
â”‚                                                                  â”‚
â”‚  Implementasi:                                                   â”‚
â”‚  - Ditanamkan di prompt scheduling                               â”‚
â”‚  - Visualisasi beban per hari di output                          â”‚
â”‚                                                                  â”‚
â”‚  Contoh output (bagian dari rencana):                            â”‚
â”‚  âš–ï¸ Distribusi Beban:                                            â”‚
â”‚  â€¢ Senin:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  berat  (6 SKS: ML + Basis Data)            â”‚
â”‚  â€¢ Selasa: â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  ringan (3 SKS: Bahasa Inggris)             â”‚
â”‚  â€¢ Rabu:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  sedang (5 SKS: Jarkom + Lab)               â”‚
â”‚  â€¢ Kamis:  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  ringan (3 SKS: PBO)                        â”‚
â”‚  â†’ Mata kuliah berat sudah disebar merata âœ…                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FITUR 5: MULTI-SCENARIO PLANNING                                â”‚
â”‚  "Beberapa opsi rencana: Padat / Seimbang / Custom"              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Apa yang dilakukan:                                             â”‚
â”‚  - Tidak cuma kasih 1 rencana, tapi beberapa OPSI               â”‚
â”‚  - Opsi A: Jadwal Padat / Lulus Cepat (SKS maksimal)            â”‚
â”‚  - Opsi B: Jadwal Seimbang / IPK Maksimal (beban merata)        â”‚
â”‚  - Opsi C: Custom sesuai permintaan user                        â”‚
â”‚                                                                  â”‚
â”‚  Cara kerja di MVP:                                              â”‚
â”‚  - Setelah AI generate rencana pertama, tawarkan opsi lain       â”‚
â”‚  - User bisa minta: "Coba yang lebih padat" atau "Coba tanpa    â”‚
â”‚    hari Jumat"                                                   â”‚
â”‚  - AI generate ulang dengan parameter berbeda                    â”‚
â”‚                                                                  â”‚
â”‚  Implementasi:                                                   â”‚
â”‚  - Di akhir output rencana, tampilkan opsi:                      â”‚
â”‚    1. ğŸ”„ Buat opsi Padat (lulus lebih cepat, 24 SKS)            â”‚
â”‚    2. ğŸ”„ Buat opsi Santai (4 hari, 18 SKS)                      â”‚
â”‚    3. âœï¸ Ubah sesuatu dari rencana ini                           â”‚
â”‚    4. âœ… Simpan rencana ini                                      â”‚
â”‚  - Ketika user pilih opsi, AI regenerate dengan instruksi baru   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FITUR 6: GRADE RESCUE CALCULATOR                                â”‚
â”‚  "Hitung berapa nilai yang dibutuhkan untuk perbaikan"           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  âš ï¸ INI SATU-SATUNYA FITUR YANG HARUS PAKAI RUMUS PYTHON        â”‚
â”‚  Alasan: Perhitungan matematika HARUS 100% akurat.              â”‚
â”‚  LLM sering salah hitung. Untuk data akademik, ini tidak boleh. â”‚
â”‚                                                                  â”‚
â”‚  Apa yang dilakukan:                                             â”‚
â”‚  - Jika AI deteksi ada mata kuliah dengan nilai rendah           â”‚
â”‚    di transkrip user, otomatis tampilkan perhitungan             â”‚
â”‚  - Hitung: "Untuk naik dari C ke B, Anda butuh nilai X di UAS"  â”‚
â”‚  - Juga bisa dipanggil via chat: "Berapa nilai yang saya         â”‚
â”‚    butuhkan supaya dapat B?"                                     â”‚
â”‚                                                                  â”‚
â”‚  Cara kerja:                                                     â”‚
â”‚  1. Grade calculator = FUNGSI PYTHON (bukan AI)                  â”‚
â”‚  2. Fungsi ini dipanggil otomatis dari output Planner            â”‚
â”‚  3. Juga bisa dipanggil dari Chatbot ketika user tanya           â”‚
â”‚  4. Hasil hitungan (angka) dikirim ke AI untuk DIJELASKAN        â”‚
â”‚                                                                  â”‚
â”‚  Rumus dasar:                                                    â”‚
â”‚  required = (target - current_total) / remaining_weight          â”‚
â”‚                                                                  â”‚
â”‚  Contoh:                                                         â”‚
â”‚  - UTS: 60, bobot 40%                                            â”‚
â”‚  - Target akhir: B (70)                                          â”‚
â”‚  - Sisa bobot: UAS 60%                                           â”‚
â”‚  - required = (70 - (60 * 0.4)) / 0.6 = 76.67                   â”‚
â”‚                                                                  â”‚
â”‚  Implementasi:                                                   â”‚
â”‚  - Buat fungsi Python di core/academic/grade_calculator.py       â”‚
â”‚  - Dipanggil oleh service.py                                     â”‚
â”‚  - Input bisa dari dokumen (parsed) ATAU dari jawaban chat user  â”‚
â”‚  - Output: angka yang akurat + AI jelaskan strateginya           â”‚
â”‚                                                                  â”‚
â”‚  Contoh output di Planner:                                       â”‚
â”‚  âš ï¸ Perhatian â€” Nilai yang Perlu Diperbaiki:                     â”‚
â”‚  â€¢ Statistika (nilai C semester lalu)                            â”‚
â”‚    â†’ Untuk naik ke B: butuh minimal 78.3 di UAS                 â”‚
â”‚    â†’ Untuk naik ke A: butuh minimal 93.3 di UAS                 â”‚
â”‚  â€¢ Kalkulus II (nilai D)                                         â”‚
â”‚    â†’ Tidak bisa diperbaiki semester ini, perlu mengulang         â”‚
â”‚                                                                  â”‚
â”‚  Contoh output di Chatbot:                                       â”‚
â”‚  User: "Nilai UTS saya 55, bobot 40%. Berapa UAS supaya B?"     â”‚
â”‚  AI: "Dengan target B (70), Anda butuhkan minimal 80.0 di UAS   â”‚
â”‚       (bobot 60%). Ini cukup menantang tapi masih mungkin! ğŸ’ª"   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CATATAN: EARLY WARNING SYSTEM (deteksi risiko akademik + kirim email)
dari product profile arah.ai TIDAK termasuk di MVP ini.
Fitur itu untuk versi production nanti.

================================================================================
8. ALUR USER (USER FLOW) â€” STEP BY STEP
================================================================================

8.1 ALUR PERTAMA KALI MASUK
-----------------------------

  1. User buka arah.ai
  2. Tampil halaman Register/Login
  3. User daftar/login
  4. Masuk ke halaman utama: MODE CHATBOT aktif
  5. AI menyapa:

     "Halo! Saya arah.ai, asisten akademik Anda ğŸ‘‹

      Saya bisa membantu dengan atau tanpa dokumen:

      ğŸ“„ Punya dokumen akademik? Kirim langsung di sini!
         (transkrip, jadwal, kurikulum â€” PDF/Excel/gambar)

      ğŸ’¬ Tidak punya? Tidak masalah!
         Ceritakan jurusan dan semester Anda, saya tetap bisa bantu.

      ğŸ“‹ Mau langsung susun rencana kuliah? Klik tombol 'Plan' di atas.

      Mau mulai dari mana?"

8.2 ALUR CHATBOT
------------------

  1. User ketik pertanyaan / upload dokumen
  2. Backend terima â†’ cek apakah ada dokumen di knowledge base
  3. RAG search dokumen yang relevan
  4. Prompt + konteks dikirim ke LLM
  5. LLM generate jawaban
  6. Jawaban ditampilkan di chat

  Itu saja. Sama seperti sekarang, tapi dengan PROMPT yang lebih pintar.

8.3 ALUR PLANNER (DETAIL)
---------------------------

  1. User klik tombol "ğŸ“‹ Plan"
  2. Backend set mode = "planner", create planner session
  3. AI kirim pertanyaan Step 1 (dengan opsi bernomor)

  STEP 1: DATA
  AI cek: apakah user sudah punya dokumen di knowledge base?

    Kalau SUDAH ada dokumen:
      "Saya sudah punya data Anda:
       â€¢ Transkrip (12 mata kuliah, IPK 3.2) âœ…
       â€¢ Jadwal Induk Semester 5 âœ…

       Mau langsung lanjut atau upload data tambahan?
       1. â–¶ï¸ Lanjut dengan data ini
       2. ğŸ“ Upload data tambahan
       3. âœï¸ Ada yang perlu dikoreksi"

    Kalau BELUM ada dokumen:
      "Apakah kamu punya dokumen akademik?
       1. ğŸ“ Ya, saya mau upload
       2. âœï¸ Tidak, saya isi manual
       3. ğŸ¤· Bantu saya tanpa data lengkap"

  STEP 2: PROFIL AKADEMIK (skip kalau sudah ada dari dokumen)
    "Jurusan kamu apa?"
    â†’ opsi bernomor + ketik sendiri

    "Semester berapa?"
    â†’ opsi bernomor

    "Mata kuliah yang sudah diambil?" (kalau tidak ada transkrip)
    â†’ user bisa sebutkan beberapa atau bilang "saya tidak ingat semua"

  STEP 3: TUJUAN
    "Apa tujuan utamamu semester ini?"
    â†’ opsi: lulus cepat / IPK tinggi / seimbang / fokus karir

    Kalau pilih "fokus karir":
    "Karir apa yang kamu targetkan?"
    â†’ opsi karrirs + ketik sendiri

  STEP 4: PREFERENSI JADWAL
    "Preferensi waktu?"
    â†’ pagi / siang-sore / fleksibel

    "Hari yang ingin dikosongkan?"
    â†’ Jumat / Sabtu / tidak ada

    "Sebar mata kuliah berat merata?"
    â†’ Ya / Terserah AI

  STEP 5: REVIEW & KONFIRMASI
    AI tampilkan ringkasan semua data:
    "Saya akan susun rencana dengan data berikut:
     â€¢ Jurusan: Teknik Informatika
     â€¢ Semester: 5
     â€¢ Tujuan: Fokus karir Data Scientist
     â€¢ Preferensi: Pagi, Jumat libur
     â€¢ Data: Transkrip + Jadwal Induk

     1. âœ… Benar, susun rencana!
     2. âœï¸ Ada yang perlu diubah"

  STEP 6: GENERATE OUTPUT (lihat contoh di bawah)

8.4 CONTOH OUTPUT PLANNER LENGKAP
------------------------------------

  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  ğŸ“‹ RENCANA PERKULIAHAN SEMESTER 5
  Teknik Informatika | Target: Data Scientist
  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  ğŸ“… JADWAL                              [Fitur 1: Automated Scheduler]
  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
  â”‚ Hari â”‚ Mata Kuliah      â”‚ Jam       â”‚ SKS â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
  â”‚ Sen  â”‚ Machine Learning â”‚ 08:00-10  â”‚ 3   â”‚
  â”‚ Sen  â”‚ Basis Data II    â”‚ 13:00-15  â”‚ 3   â”‚
  â”‚ Sel  â”‚ Statistika       â”‚ 10:00-12  â”‚ 3   â”‚
  â”‚ Sel  â”‚ Data Mining      â”‚ 13:00-15  â”‚ 3   â”‚
  â”‚ Rab  â”‚ Jarkom           â”‚ 08:00-10  â”‚ 3   â”‚
  â”‚ Rab  â”‚ PBO              â”‚ 13:00-15  â”‚ 3   â”‚
  â”‚ Kam  â”‚ Bahasa Inggris   â”‚ 10:00-12  â”‚ 2   â”‚
  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
  Total: 20 SKS | 4 hari aktif | Jumat libur âœ…

  ğŸ¯ REKOMENDASI                         [Fitur 2: Course Recommendation]
  Mata kuliah di atas dipilih karena:
  â€¢ Machine Learning â€” wajib semester 5, prasyarat: Statistika âœ…
  â€¢ Data Mining â€” pilihan, sangat relevan untuk karir
  â€¢ Basis Data II â€” wajib, prasyarat: Basis Data I âœ…
  âŒ AI tidak rekomendasikan "Kecerdasan Buatan" karena prasyarat
     Kalkulus III belum Anda ambil

  ğŸ’¼ KESELARASAN KARIR                    [Fitur 3: Career Alignment]
  Target: Data Scientist
  â€¢ Machine Learning    â˜…â˜…â˜… (core skill)
  â€¢ Statistika          â˜…â˜…â˜… (fundamental)
  â€¢ Data Mining         â˜…â˜…â˜† (complementary)
  â€¢ Basis Data II       â˜…â˜…â˜† (data management)
  â€¢ Bahasa Inggris      â˜…â˜†â˜† (supporting)

  âš–ï¸ DISTRIBUSI BEBAN                     [Fitur 4: Cognitive Load]
  â€¢ Senin:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  berat  (6 SKS â€” tapi ada jeda 3 jam)
  â€¢ Selasa: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  berat  (6 SKS â€” topik serumpun, efisien)
  â€¢ Rabu:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  berat  (6 SKS â€” ada jeda 3 jam)
  â€¢ Kamis:  â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  ringan (2 SKS â€” hari santai)
  â†’ Beban sudah disebar. Kamis jadi hari recovery. âœ…

  âš ï¸ PERHATIAN NILAI                      [Fitur 6: Grade Rescue]
  AI mendeteksi nilai rendah dari transkrip Anda:
  â€¢ Statistika (nilai C semester 3)
    â†’ Untuk naik ke B: butuh minimal 78.3 di UAS
    â†’ Untuk naik ke A: butuh minimal 93.3 di UAS
    â†’ Saran: Fokus di semester ini karena Statistika jadi prasyarat ML

  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  Mau apa selanjutnya?                    [Fitur 5: Multi-Scenario]
  1. ğŸ”„ Buat opsi Padat (24 SKS, lulus lebih cepat)
  2. ğŸ”„ Buat opsi Santai (16 SKS, 3 hari kuliah)
  3. ğŸ“Š Hitung detail target nilai untuk semua mata kuliah
  4. âœï¸ Ubah sesuatu dari rencana ini
  5. âœ… Simpan rencana ini

  âš ï¸ Rencana ini berdasarkan data yang Anda berikan.
  Cocokkan dengan jadwal resmi kampus Anda.

  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

================================================================================
9. APA YANG HARUS DIKERJAKAN (TASK BREAKDOWN)
================================================================================

Total 10 task, estimasi 18 hari kerja.
Urutan HARUS diikuti (ada dependensi).

  â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  #  â”‚ Task                               â”‚ Durasi â”‚ Dependensi  â”‚
  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚  1  â”‚ Chatbot prompt upgrade             â”‚ 2 hari â”‚ -           â”‚
  â”‚  2  â”‚ Grade calculator (Python)          â”‚ 1 hari â”‚ -           â”‚
  â”‚  3  â”‚ Planner state machine (backend)    â”‚ 2 hari â”‚ -           â”‚
  â”‚  4  â”‚ Planner prompts per step           â”‚ 3 hari â”‚ Task 3      â”‚
  â”‚  5  â”‚ Planner output generator           â”‚ 2 hari â”‚ Task 2, 4   â”‚
  â”‚  6  â”‚ Data level detection               â”‚ 1 hari â”‚ Task 3      â”‚
  â”‚  7  â”‚ Frontend: opsi bernomor di chat    â”‚ 2 hari â”‚ Task 4      â”‚
  â”‚  8  â”‚ Frontend: render output rencana    â”‚ 2 hari â”‚ Task 5, 7   â”‚
  â”‚  9  â”‚ Frontend: upload inline + toggle   â”‚ 2 hari â”‚ -           â”‚
  â”‚ 10  â”‚ Testing semua skenario             â”‚ 2 hari â”‚ Semua       â”‚
  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Bisa dikerjakan paralel:
  - Task 1, 2, 3, 9 bisa BERSAMAAN (tidak ada dependensi)
  - Task 4, 6 bersamaan setelah Task 3 selesai
  - Task 5 setelah Task 2 dan 4 selesai
  - Task 7 setelah Task 4 selesai
  - Task 8 setelah Task 5 dan 7 selesai

  Timeline optimal (dengan 2 developer):

  Minggu 1: Task 1 + 2 + 3 + 9 (paralel)
  Minggu 2: Task 4 + 6 (paralel), lalu Task 5
  Minggu 3: Task 7 + 8 (paralel)
  Minggu 4: Task 10 (testing) + bugfix

================================================================================
10. DETAIL TEKNIS PER TASK
================================================================================

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TASK 1: CHATBOT PROMPT UPGRADE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Tujuan: Buat AI chatbot lebih pintar soal akademik.

File yang diubah:
  core/ai_engine/retrieval/prompt.py  â† UBAH prompt template

Apa yang harus dilakukan:

  1. Ganti LLM_FIRST_TEMPLATE dengan prompt baru yang:

     a. Punya PERSONA yang jelas:
        "Kamu adalah arah.ai, asisten akademik yang ramah dan proaktif."

     b. Punya ATURAN adaptif berdasarkan data:
        - Jika konteks dari dokumen ada â†’ jawab berdasarkan dokumen
        - Jika konteks kosong â†’ jawab dari pengetahuan umum
        - Jika butuh info tambahan â†’ TANYA BALIK ke user
        - JANGAN PERNAH bilang "saya tidak bisa membantu"

     c. Paham terminologi akademik:
        - SKS, IPK, IPS, KRS, prasyarat, transkrip, jadwal induk
        - Sistem nilai: A=4, B=3, C=2, D=1, E=0
        - Aturan umum perkuliahan di Indonesia

     d. Format output FLEKSIBEL (bukan wajib pakai semua heading):
        - Gunakan tabel kalau ada data tabel
        - Gunakan bullet point kalau list
        - Gunakan paragraf kalau penjelasan
        - Selalu akhiri dengan opsi follow-up

  2. Tambahkan ONBOARDING PROMPT terpisah untuk user baru:
     - Sapa user
     - Jelaskan kemampuan sistem
     - Tawarkan upload dokumen ATAU chat langsung
     - Mention fitur Planner

  3. Update rules.py kalau perlu:
     - Tambah keyword detection untuk query akademik spesifik
     - Misal: "hitung nilai", "berapa yang dibutuhkan" â†’ trigger grade calc

Contoh prompt baru (garis besar, perlu di-refine):

  """
  Kamu adalah arah.ai, asisten akademik yang cerdas, ramah, dan proaktif.

  IDENTITAS:
  - Nama: arah.ai
  - Peran: Navigator akademik untuk mahasiswa perguruan tinggi Indonesia
  - Gaya: Ramah, mendukung, tidak menghakimi, selalu menawarkan solusi

  KEMAMPUAN:
  - Menjawab pertanyaan tentang perkuliahan dan pendidikan tinggi
  - Membaca dan menganalisis dokumen akademik (transkrip, jadwal, kurikulum)
  - Menghitung nilai yang dibutuhkan (Grade Rescue)
  - Memberikan rekomendasi mata kuliah dan strategi belajar
  - Untuk perencanaan lengkap, sarankan fitur Planner

  ATURAN UTAMA:
  1. SELALU bantu, sebisa mungkin, dengan data yang ada
  2. Jika data kurang, TANYA BALIK â€” jangan menolak
  3. Jika tidak yakin, bilang dengan jujur dan kasih alternatif
  4. Jangan hallucinate data â€” kalau tidak tahu, bilang tidak tahu
  5. Selalu akhiri dengan opsi tindak lanjut

  KONTEKS DOKUMEN USER:
  {context}

  PERTANYAAN:
  {input}

  JAWABAN (Markdown, format sesuai kebutuhan):
  """

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TASK 2: GRADE CALCULATOR (PYTHON)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Tujuan: Fungsi Python yang menghitung nilai yang dibutuhkan. 100% akurat.

File baru yang dibuat:
  core/academic/__init__.py           â† file kosong (agar jadi Python package)
  core/academic/grade_calculator.py   â† fungsi kalkulasi

Apa yang harus ada di grade_calculator.py:

  Fungsi 1: calculate_required_score
  -----------------------------------
  Input:
    - components: list komponen nilai yang SUDAH ada
      Contoh: [{"name": "UTS", "weight": 40, "score": 60}]
    - target_grade: target nilai akhir (misal 70 untuk B)
    - remaining_components: list komponen yang BELUM ada
      Contoh: [{"name": "UAS", "weight": 60}]

  Output:
    - dict per remaining component: {"UAS": {"required": 76.67, "possible": True}}

  Logika:
    achieved = sum(comp.score * comp.weight / 100 for comp in components)
    remaining_weight = sum(comp.weight for comp in remaining_components)
    required_total = target_grade - achieved
    required_avg = required_total / (remaining_weight / 100)
    possible = required_avg <= 100

  Fungsi 2: get_grade_letter
  ---------------------------
  Input: numeric score
  Output: letter grade (A/B/C/D/E) berdasarkan skala umum Indonesia

  Skala default:
    A  = 80-100 (4.0)
    B  = 70-79  (3.0)
    C  = 56-69  (2.0)
    D  = 45-55  (1.0)
    E  = 0-44   (0.0)

  CATATAN: Skala bisa beda per kampus. Buat parameter opsional.

  Fungsi 3: analyze_transcript_risks
  ------------------------------------
  Input: list mata kuliah + nilai
  Output: list mata kuliah yang "berisiko" (nilai < C atau D)
    + perhitungan perbaikan per mata kuliah

Integrasi:
  - Di service.py, tambah fungsi yang memanggil grade_calculator
  - Fungsi ini dipanggil dari:
    a. Planner output generator (otomatis deteksi nilai rendah)
    b. Chatbot (ketika user tanya soal nilai)
  - Cara detect dari chat: rules.py tambah pattern untuk "hitung nilai",
    "berapa yang dibutuhkan", "grade rescue", dll

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TASK 3: PLANNER STATE MACHINE (BACKEND)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Tujuan: Backend yang track posisi user di wizard Planner.

Konsep:
  Planner = serangkaian pertanyaan (steps).
  Setiap step punya:
  - Pertanyaan yang ditampilkan
  - Opsi jawaban (numbered)
  - Data yang dikumpulkan dari jawaban user

  Backend perlu INGAT:
  - User ada di step berapa
  - Data apa yang sudah dikumpulkan
  - Dokumen apa yang sudah tersedia

File baru yang dibuat:
  core/academic/planner.py   â† State machine logic

Apa yang harus ada:

  PLANNER_STEPS = [
    "data",        # Step 1: Cek / upload data
    "profile",     # Step 2: Jurusan, semester
    "goals",       # Step 3: Tujuan + karir
    "preferences", # Step 4: Preferensi jadwal
    "review",      # Step 5: Konfirmasi
    "generate",    # Step 6: Generate rencana
    "iterate",     # Step 7: Revisi / scenario lain
  ]

  Class atau dict: PlannerSession
    - user_id
    - current_step: string (nama step saat ini)
    - collected_data: dict (data dari jawaban user)
      {
        "jurusan": "Teknik Informatika",
        "semester": 5,
        "goal": "career",
        "career": "Data Scientist",
        "time_pref": "morning",
        "free_day": "friday",
        "balance_load": True,
        "has_transcript": True,
        "has_schedule": False,
      }
    - available_documents: list dokumen yang sudah di-upload

  Penyimpanan state:
  Opsi 1 (SIMPLE, recommended untuk MVP):
    Simpan di Django session (request.session["planner"])
    Pro: Tidak perlu model baru, cepat
    Kontra: Hilang kalau session expire

  Opsi 2:
    Buat model PlannerSession di models.py
    Pro: Persistent
    Kontra: Lebih kompleks

  RECOMMEND: Opsi 1 (session) untuk MVP.

  Fungsi utama:

    def get_current_step(session_data) -> dict:
      """Return pertanyaan + opsi untuk step saat ini"""

    def process_answer(session_data, user_answer) -> dict:
      """Proses jawaban user, update data, pindah ke step berikutnya"""

    def should_skip_step(step, session_data) -> bool:
      """Cek apakah step bisa di-skip (misal profil sudah ada dari dokumen)"""

    def generate_plan(session_data, user_id) -> dict:
      """Generate rencana lengkap dari semua data yang terkumpul"""

API Endpoint:
  Opsi A (SIMPLE, recommended):
    Extend POST /api/chat/ â€” tambah field "mode": "planner"
    Backend cek mode â†’ kalau planner, route ke planner logic
    Pro: Tidak perlu endpoint baru, frontend cuma tambah field

  Opsi B:
    Buat POST /api/planner/ terpisah
    Pro: Separation of concerns
    Kontra: Lebih banyak kode

  RECOMMEND: Opsi A â€” extend /api/chat/ dengan parameter mode.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TASK 4: PLANNER PROMPTS PER STEP
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Tujuan: Prompt template khusus untuk setiap step wizard Planner.

File yang diubah/ditambah:
  core/ai_engine/retrieval/prompt.py  â† Tambah prompt templates

Apa yang harus dibuat:

  Untuk setiap step, buat template prompt yang menghasilkan:
  - Teks pertanyaan yang ramah dan jelas
  - Opsi bernomor (numbered list)
  - Opsi terakhir selalu "ketik sendiri" atau "skip"

  Format output dari LLM harus STRUCTURED agar frontend bisa parse:

  Opsi 1 (SIMPLE, recommended):
    Backend TIDAK pakai LLM untuk generate pertanyaan step.
    Pertanyaan dan opsi di-hardcode di planner.py.
    LLM hanya dipakai di step terakhir (generate rencana).

    Pro: Cepat, deterministic, gratis (tidak pakai token LLM)
    Kontra: Kurang fleksibel

  Opsi 2:
    LLM generate pertanyaan adaptive per step.
    Pro: Bisa adapt berdasarkan konteks user
    Kontra: Lambat, costly, bisa inconsistent

  RECOMMEND: Opsi 1 untuk MVP â€” hardcode pertanyaan, LLM hanya untuk output.

  Kalau pilih Opsi 1, di planner.py buat dict:

    STEP_QUESTIONS = {
      "data": {
        "question": "Apakah kamu punya dokumen akademik?",
        "options": [
          {"id": 1, "label": "ğŸ“ Ya, saya mau upload file", "action": "upload"},
          {"id": 2, "label": "âœï¸ Tidak, saya isi manual", "action": "manual"},
          {"id": 3, "label": "ğŸ¤· Bantu tanpa data lengkap", "action": "no_data"},
        ],
        "allow_custom": False,
      },
      "profile_jurusan": {
        "question": "Jurusan kamu apa?",
        "options": [
          {"id": 1, "label": "Teknik Informatika"},
          {"id": 2, "label": "Sistem Informasi"},
          {"id": 3, "label": "Manajemen"},
          {"id": 4, "label": "Akuntansi"},
          {"id": 5, "label": "Hukum"},
        ],
        "allow_custom": True,  # bisa ketik jurusan sendiri
      },
      ... dst untuk setiap sub-step
    }

  Untuk step GENERATE (step terakhir), baru pakai LLM prompt:

    PLANNER_OUTPUT_TEMPLATE = """
    Kamu adalah arah.ai. Susun rencana perkuliahan berdasarkan data berikut.

    DATA USER:
    - Jurusan: {jurusan}
    - Semester: {semester}
    - Tujuan: {goal}
    - Target karir: {career}
    - Preferensi waktu: {time_pref}
    - Hari libur: {free_day}

    DOKUMEN USER (dari knowledge base):
    {context}

    INSTRUKSI OUTPUT:
    Susun rencana dengan format WAJIB berikut:

    ## ğŸ“… Jadwal
    (tabel: Hari | Mata Kuliah | Jam | SKS)
    (pastikan TIDAK ada bentrok waktu)
    (total SKS dan jumlah hari aktif)

    ## ğŸ¯ Rekomendasi Mata Kuliah
    (mengapa mata kuliah ini dipilih)
    (cek prasyarat jika info tersedia)

    ## ğŸ’¼ Keselarasan Karir
    (rating â˜… per mata kuliah terhadap karir target)

    ## âš–ï¸ Distribusi Beban
    (visualisasi beban per hari)
    (konfirmasi apakah sudah seimbang)

    ## âš ï¸ Perhatian Nilai
    (jika ada nilai rendah dari transkrip, tampilkan)
    (gunakan data perhitungan berikut: {grade_rescue_data})
    (jika tidak ada data nilai, skip section ini)

    ## Selanjutnya
    Tampilkan opsi:
    1. ğŸ”„ Buat opsi Padat
    2. ğŸ”„ Buat opsi Santai
    3. âœï¸ Ubah sesuatu
    4. âœ… Simpan rencana ini

    CATATAN: Selalu akhiri dengan disclaimer jika data tidak lengkap.
    """

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TASK 5: PLANNER OUTPUT GENERATOR
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Tujuan: Generate rencana perkuliahan lengkap dari data yang dikumpulkan wizard.

File yang diubah/ditambah:
  core/academic/planner.py      â† Tambah generate_plan()
  core/service.py               â† Tambah fungsi orchestration
  core/ai_engine/retrieval/     â† Panggil LLM dengan prompt planner

Apa yang harus dilakukan:

  1. Kumpulkan semua data dari planner session
  2. Ambil dokumen relevan dari ChromaDB (kalau ada)
  3. Panggil grade_calculator (kalau ada data nilai)
  4. Kirim semua ke LLM dengan PLANNER_OUTPUT_TEMPLATE
  5. Parse output â†’ kirim ke frontend

  Alur kode:

    def generate_plan(user, session_data) -> dict:
      # 1. Ambil konteks dari knowledge base
      context = get_relevant_context(user.id, session_data)

      # 2. Hitung grade rescue (kalau ada transkrip)
      grade_data = ""
      if has_transcript_data(session_data):
        grade_data = calculate_all_risks(user)

      # 3. Susun prompt
      prompt = PLANNER_OUTPUT_TEMPLATE.format(
        jurusan=session_data["jurusan"],
        semester=session_data["semester"],
        goal=session_data["goal"],
        career=session_data.get("career", "tidak ditentukan"),
        time_pref=session_data.get("time_pref", "fleksibel"),
        free_day=session_data.get("free_day", "tidak ada"),
        context=context,
        grade_rescue_data=grade_data,
      )

      # 4. Panggil LLM
      answer = call_llm(prompt)

      return {"answer": answer, "type": "planner_output"}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TASK 6: DATA LEVEL DETECTION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Tujuan: Backend cek dokumen apa yang user sudah punya, tentukan level.

File yang diubah:
  core/academic/planner.py  â† Tambah detect_data_level()
  core/service.py           â† Panggil saat planner mulai

Apa yang harus dilakukan:

  def detect_data_level(user) -> dict:
    docs = AcademicDocument.objects.filter(user=user, is_embedded=True)

    has_transcript = any(is_transcript(d) for d in docs)
    has_schedule = any(is_schedule(d) for d in docs)
    has_curriculum = any(is_curriculum(d) for d in docs)

    level = 0
    if has_transcript or has_schedule:
      level = 2
    if has_transcript and has_schedule:
      level = 3

    return {
      "level": level,
      "has_transcript": has_transcript,
      "has_schedule": has_schedule,
      "has_curriculum": has_curriculum,
      "documents": [d.title for d in docs],
    }

  Cara detect tipe dokumen:
  - Cek metadata doc_type yang sudah di-set saat ingest
  - Atau cek judul/nama file (transkrip, jadwal, kurikulum)

  Ini dipakai di Step 1 Planner:
  - Kalau level 3 â†’ "Saya sudah punya data lengkap, mau lanjut?"
  - Kalau level 2 â†’ "Saya punya sebagian data, ada yang kurang"
  - Kalau level 0-1 â†’ "Upload atau isi manual"

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TASK 7: FRONTEND â€” OPSI BERNOMOR DI CHAT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Tujuan: Chat bubble AI bisa menampilkan opsi bernomor yang BISA DIKLIK.

File yang diubah:
  frontend/src/components/molecules/ChatBubble.tsx  â† Tambah render opsi
  frontend/src/pages/Chat/Index.tsx                 â† Handle klik opsi

Apa yang harus dilakukan:

  1. Backend kirim response dengan format:
    {
      "answer": "Jurusan kamu apa?",
      "type": "planner_step",          // BARU: tipe pesan
      "options": [                      // BARU: opsi bernomor
        {"id": 1, "label": "Teknik Informatika"},
        {"id": 2, "label": "Sistem Informasi"},
        {"id": 3, "label": "Manajemen"},
      ],
      "allow_custom": true              // BARU: boleh ketik sendiri?
    }

  2. Frontend ChatBubble detect "options" field:
    - Kalau ada â†’ render sebagai tombol/card bernomor
    - Kalau tidak ada â†’ render sebagai markdown biasa (seperti sekarang)

  3. Ketika user klik opsi:
    - Tampilkan jawaban user di chat (sebagai bubble user)
    - Kirim ke backend: POST /api/chat/ dengan body:
      {"message": "1", "mode": "planner", "option_id": 1}
    - Backend proses jawaban â†’ return step berikutnya

  4. Styling opsi:
    - Card dengan nomor, bisa diklik
    - Hover effect
    - Warna berbeda untuk opsi yang dipilih
    - Responsive mobile

  Referensi desain: Lihat screenshot yang diberikan â€” menggunakan
  numbered list dengan highlight pada yang dipilih (mirip quick pick menu).

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TASK 8: FRONTEND â€” RENDER OUTPUT RENCANA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Tujuan: Tampilkan output rencana lengkap Planner secara visual di chat.

File yang diubah:
  frontend/src/components/molecules/ChatBubble.tsx  â† Enhanced rendering
  (mungkin komponen baru di molecules/ atau organisms/)

Apa yang harus dilakukan:

  Output rencana dari LLM sudah dalam format Markdown.
  Sistem sekarang sudah render Markdown di chat (react-markdown + remark-gfm).

  Yang perlu ditambah/diperbaiki:
  1. Tabel Markdown harus render dengan baik (bordered, responsive)
  2. Section headers (##) harus punya styling berbeda
  3. Emoji harus tampil
  4. Progress bar untuk distribusi beban (opsional â€” bisa pakai emoji â–ˆâ–ˆâ–ˆâ–ˆ)
  5. Rating bintang â˜…â˜…â˜… harus tampil
  6. Opsi di akhir output harus jadi tombol yang bisa diklik (sama seperti Task 7)

  Markdown rendering sudah ada:
  - react-markdown di dependencies âœ…
  - remark-gfm (support tabel GitHub Flavored Markdown) âœ…
  - rehype-sanitize (security) âœ…

  Yang mungkin perlu:
  - Custom CSS untuk tabel agar lebih bagus
  - Custom component untuk render section khusus (jadwal, beban)
  - Responsive design (tabel tidak overflow di mobile)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TASK 9: FRONTEND â€” UPLOAD INLINE + TOGGLE MODE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Tujuan: (A) Upload file langsung di chat, (B) Tombol switch Chat â†” Plan.

File yang diubah:
  frontend/src/components/molecules/ChatComposer.tsx  â† Tambah tombol ğŸ“
  frontend/src/pages/Chat/Index.tsx                   â† Handle upload + mode
  frontend/src/components/organisms/AppHeader.tsx      â† Toggle button

BAGIAN A: UPLOAD INLINE

  1. Tambah tombol ğŸ“ (clip/attachment) di samping input chat
  2. Klik â†’ buka file picker (accept: .pdf,.xlsx,.xls,.csv,.md,.txt)
  3. ATAU drag & drop file ke area chat
  4. Setelah file dipilih:
    - Tampilkan preview nama file di chat ("Uploading transkrip.pdf...")
    - Panggil uploadDocuments() dari api.ts (sudah ada!)
    - Setelah sukses: "âœ… transkrip.pdf berhasil di-upload dan diproses"
    - AI otomatis baca: "Saya menemukan 12 mata kuliah di transkrip Anda..."

  Upload logic SUDAH ADA di codebase:
  - api.ts: uploadDocuments() âœ…
  - views.py: upload_api() âœ…
  - service.py: upload_files_batch() âœ…
  - ingest.py: process_document() âœ…

  Yang perlu: cuma UI di chat (tombol ğŸ“ + drag area).

BAGIAN B: TOGGLE MODE

  1. Di header (AppHeader), tambah toggle button:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ’¬ Chat  â”‚  â”‚ ğŸ“‹ Plan  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  2. Ketika klik "ğŸ“‹ Plan":
    - Set state mode = "planner"
    - Kalau pertama kali â†’ kirim request ke backend untuk mulai planner
    - Backend return Step 1 question
    - Tampilkan di chat

  3. Ketika klik "ğŸ’¬ Chat":
    - Set state mode = "chat"
    - Kembali ke mode chat biasa
    - Planner state tetap disimpan (bisa lanjut nanti)

  4. Mode mempengaruhi:
    - Apa yang dikirim ke backend (tambah "mode" field di request body)
    - Bagaimana response ditampilkan (opsi bernomor vs text biasa)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
TASK 10: TESTING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Tujuan: Pastikan semua fitur berjalan di semua skenario.

Test scenarios:

  A. CHATBOT TESTS
  1. Chat tanpa dokumen â†’ AI harus tetap jawab, tanya balik
  2. Upload transkrip â†’ chat tanya "jadwal saya?" â†’ AI jawab dari dokumen
  3. Upload format aneh â†’ AI harus handle gracefully
  4. Tanya "berapa nilai yang saya butuhkan?" tanpa data â†’ AI tanya balik
  5. Tanya "berapa nilai yang saya butuhkan?" dengan data â†’ grade calculator jalan

  B. PLANNER TESTS â€” LEVEL 3 (data lengkap)
  6. Upload transkrip + jadwal induk â†’ mulai planner â†’ skip step data â†’
     pilih tujuan â†’ generate rencana lengkap (semua 6 section harus ada)

  C. PLANNER TESTS â€” LEVEL 2 (data sebagian)
  7. Upload cuma transkrip â†’ mulai planner â†’ AI notice "jadwal induk belum ada"
     â†’ tawarkan upload atau manual â†’ generate rencana parsial + disclaimer

  D. PLANNER TESTS â€” LEVEL 0 (tanpa data)
  8. Tidak upload apa-apa â†’ mulai planner â†’ isi manual step by step â†’
     generate rencana + disclaimer

  E. PLANNER TESTS â€” FITUR SPESIFIK
  9. Multi-scenario: Setelah rencana, klik "Buat opsi Padat" â†’ generate ulang
  10. Grade rescue: Transkrip ada nilai C â†’ output otomatis tampilkan perhitungan
  11. Career alignment: Pilih karir â†’ output ada rating â˜… per mata kuliah

  F. EDGE CASES
  12. Switch Chat â†” Planner di tengah jalan â†’ state harus preserved
  13. Upload file di tengah planner wizard â†’ data level berubah â†’ step adapt
  14. User ketik jawaban custom (bukan pilih opsi) â†’ harus tetap diterima

  G. MOBILE
  15. Semua fitur harus usable di layar HP (responsive)

================================================================================
11. FILE-FILE YANG PERLU DIUBAH
================================================================================

LEGEND:
  [NEW]    = File baru yang perlu dibuat
  [MODIFY] = File yang sudah ada, perlu diubah
  [READ]   = File yang perlu dipahami tapi tidak diubah

BACKEND:
  [NEW]    core/academic/__init__.py
  [NEW]    core/academic/grade_calculator.py       â† Task 2
  [NEW]    core/academic/planner.py                â† Task 3, 4, 5, 6
  [MODIFY] core/ai_engine/retrieval/prompt.py      â† Task 1, 4
  [MODIFY] core/ai_engine/retrieval/rules.py       â† Task 1
  [MODIFY] core/ai_engine/retrieval/main.py        â† Task 5 (minor)
  [MODIFY] core/service.py                         â† Task 2, 3, 5, 6
  [MODIFY] core/views.py                           â† Task 3 (extend chat API)
  [MODIFY] core/urls.py                            â† Task 3 (kalau endpoint baru)
  [READ]   core/ai_engine/config.py                â† Pahami ChromaDB setup
  [READ]   core/ai_engine/ingest.py                â† Pahami document processing
  [READ]   core/ai_engine/retrieval/llm.py         â† Pahami LLM config
  [READ]   core/models.py                          â† Pahami data models

FRONTEND:
  [MODIFY] frontend/src/lib/api.ts                 â† Task 7, 9
  [MODIFY] frontend/src/pages/Chat/Index.tsx        â† Task 7, 8, 9
  [MODIFY] frontend/src/components/molecules/ChatBubble.tsx    â† Task 7, 8
  [MODIFY] frontend/src/components/molecules/ChatComposer.tsx  â† Task 9
  [MODIFY] frontend/src/components/organisms/AppHeader.tsx     â† Task 9

TESTS:
  [NEW]    core/test/test_grade_calculator.py       â† Task 10
  [NEW]    core/test/test_planner.py                â† Task 10

================================================================================
12. CONTOH KODE & PSEUDOCODE
================================================================================

12.1 GRADE CALCULATOR (Python lengkap)
----------------------------------------

  # core/academic/grade_calculator.py

  def calculate_required_score(
      achieved_components,   # [{"name": "UTS", "weight": 40, "score": 60}]
      target_final_score,    # 70 (untuk B)
      remaining_weight       # 60 (bobot UAS)
  ):
      """
      Hitung berapa nilai yang dibutuhkan di komponen yang tersisa.

      Contoh:
        UTS = 60, bobot 40%
        Target = 70 (B)
        Sisa = UAS, bobot 60%

        achieved = 60 * 0.40 = 24
        needed = 70 - 24 = 46
        required = 46 / 0.60 = 76.67
      """
      achieved = sum(
          c["score"] * (c["weight"] / 100.0)
          for c in achieved_components
      )

      needed = target_final_score - achieved
      if remaining_weight <= 0:
          return {"required": None, "possible": False, "reason": "Tidak ada komponen tersisa"}

      required = needed / (remaining_weight / 100.0)

      return {
          "required": round(required, 2),
          "possible": 0 <= required <= 100,
          "achieved_so_far": round(achieved, 2),
          "needed_points": round(needed, 2),
      }

  # Contoh penggunaan:
  # result = calculate_required_score(
  #     achieved_components=[{"name": "UTS", "weight": 40, "score": 60}],
  #     target_final_score=70,
  #     remaining_weight=60
  # )
  # result = {"required": 76.67, "possible": True, ...}


12.2 PLANNER STATE MACHINE (Pseudocode)
------------------------------------------

  # core/academic/planner.py

  STEPS = ["data", "profile", "goals", "preferences", "review", "generate"]

  def start_planner(user):
      data_level = detect_data_level(user)
      session_data = {
          "current_step": "data",
          "collected_data": {},
          "data_level": data_level,
      }

      # Skip step data kalau sudah ada dokumen lengkap
      if data_level["level"] >= 3:
          session_data["current_step"] = "goals"  # skip data & profile
          session_data["collected_data"].update(extract_profile_from_docs(user))

      return get_step_content(session_data)

  def process_planner_message(user, message, session_data):
      current = session_data["current_step"]

      # Parse jawaban user
      answer = parse_answer(message, current)
      session_data["collected_data"].update(answer)

      # Pindah ke step berikutnya
      next_step = get_next_step(current, session_data)

      if next_step == "generate":
          return generate_plan(user, session_data)

      session_data["current_step"] = next_step
      return get_step_content(session_data)

  def get_step_content(session_data):
      step = session_data["current_step"]

      if step == "data":
          return {
              "answer": "Apakah kamu punya dokumen akademik?",
              "type": "planner_step",
              "options": [
                  {"id": 1, "label": "ğŸ“ Ya, saya mau upload file"},
                  {"id": 2, "label": "âœï¸ Tidak, saya isi manual"},
                  {"id": 3, "label": "ğŸ¤· Bantu tanpa data lengkap"},
              ],
          }
      elif step == "profile":
          return {
              "answer": "Jurusan kamu apa?",
              "type": "planner_step",
              "options": [...],
              "allow_custom": True,
          }
      # ... dst


12.3 EXTEND CHAT API (Pseudocode)
------------------------------------

  # Di views.py, ubah chat_api:

  def chat_api(request):
      data = json.loads(request.body)
      message = data.get("message")
      mode = data.get("mode", "chat")  # BARU: default "chat"
      session_id = data.get("session_id")

      if mode == "planner":
          # Ambil planner state dari session
          planner_data = request.session.get("planner", None)

          if not planner_data:
              # Pertama kali â†’ mulai planner
              result = planner.start_planner(request.user)
              request.session["planner"] = result["session_data"]
          else:
              # Lanjutkan step
              result = planner.process_planner_message(
                  request.user, message, planner_data
              )
              request.session["planner"] = result.get("session_data", planner_data)

          return JsonResponse(result)

      else:
          # Mode chat biasa â†’ alur yang sudah ada
          result = service.chat_and_save(request.user, message, session_id)
          return JsonResponse(result)


12.4 FRONTEND â€” CHAT BUBBLE DENGAN OPSI (Pseudocode JSX)
-----------------------------------------------------------

  // Di ChatBubble.tsx, tambah rendering opsi:

  function ChatBubble({ message, onOptionClick }) {
    return (
      <div className="chat-bubble">
        {/* Render teks pesan (markdown) */}
        <ReactMarkdown>{message.answer}</ReactMarkdown>

        {/* Render opsi bernomor kalau ada */}
        {message.options && (
          <div className="options-list">
            {message.options.map((opt) => (
              <button
                key={opt.id}
                onClick={() => onOptionClick(opt)}
                className="option-button"
              >
                <span className="option-number">{opt.id}</span>
                <span className="option-label">{opt.label}</span>
              </button>
            ))}
          </div>
        )}

        {/* Input custom kalau allow_custom */}
        {message.allow_custom && (
          <input placeholder="Atau ketik sendiri..." />
        )}
      </div>
    );
  }


12.5 FRONTEND â€” MODE TOGGLE (Pseudocode JSX)
-----------------------------------------------

  // Di AppHeader.tsx atau komponen baru:

  function ModeToggle({ mode, onModeChange }) {
    return (
      <div className="mode-toggle">
        <button
          className={mode === "chat" ? "active" : ""}
          onClick={() => onModeChange("chat")}
        >
          ğŸ’¬ Chat
        </button>
        <button
          className={mode === "planner" ? "active" : ""}
          onClick={() => onModeChange("planner")}
        >
          ğŸ“‹ Plan
        </button>
      </div>
    );
  }

  // Di Chat/Index.tsx:
  const [mode, setMode] = useState("chat");

  const handleSend = async (message) => {
    const response = await sendChat(message, activeSession, mode);
    // response bisa punya "options" field kalau mode planner
    addMessageToChat(response);
  };

================================================================================
13. TESTING & VALIDASI
================================================================================

Cara menjalankan test:

  Backend:
    cd academic_rag_project
    python manage.py test core.test

  Frontend:
    cd frontend
    npx playwright test          # E2E tests
    npm run lint                 # Lint check

Kriteria LULUS untuk MVP:

  âœ… User bisa register, login, logout
  âœ… User bisa chat bebas tentang akademik (tanpa upload)
  âœ… User bisa upload dokumen di chat (ğŸ“ button)
  âœ… User bisa chat berdasarkan dokumen yang di-upload
  âœ… User bisa switch ke mode Planner
  âœ… Planner wizard step-by-step berjalan di chat
  âœ… Planner adaptif: skip step kalau data sudah ada
  âœ… Planner generate output lengkap (6 fitur terlihat)
  âœ… Grade calculator akurat (test manual: hitung sendiri, bandingkan)
  âœ… User bisa minta opsi alternatif dari Planner
  âœ… Disclaimer muncul kalau data tidak lengkap
  âœ… Responsive di mobile
  âœ… Tidak ada error 500 di happy path

================================================================================
14. HAL YANG TIDAK PERLU DIKERJAKAN (OUT OF SCOPE MVP)
================================================================================

  âŒ Integrasi SIAKAD (koneksi ke sistem kampus)
  âŒ Early Warning System (email otomatis ke mahasiswa/dosen)
  âŒ Scheduling algorithm (backtracking/genetic) â€” cukup prompt-based
  âŒ Database mata kuliah per kampus â€” pakai upload user
  âŒ Admin dashboard
  âŒ Payment / subscription
  âŒ Multi-language (cukup Bahasa Indonesia)
  âŒ PWA / mobile app
  âŒ Real-time collaboration
  âŒ Export PDF rencana (nice to have, tapi bukan MVP)
  âŒ Prerequisite graph algorithm â€” cukup prompt-based
  âŒ Data model baru di models.py (Course, MasterSchedule, dll) â€” tidak perlu
     karena semua data dari upload user, bukan database kita

================================================================================
15. GLOSARIUM (ISTILAH-ISTILAH)
================================================================================

  RAG (Retrieval-Augmented Generation):
    Teknik AI dimana sistem "cari dulu dokumen yang relevan" sebelum
    menjawab pertanyaan. Jadi AI tidak asal jawab dari pengetahuan umum,
    tapi berdasarkan data spesifik user.

  LLM (Large Language Model):
    Model AI bahasa besar seperti ChatGPT, Llama, Qwen. Ini yang
    "berpikir" dan generate jawaban. Kita akses via OpenRouter API.

  ChromaDB:
    Database vektor. Menyimpan dokumen dalam bentuk angka-angka
    (embedding) supaya bisa dicari berdasarkan kemiripan makna.

  Embedding:
    Proses mengubah teks menjadi deretan angka (vektor) yang
    merepresentasikan maknanya. Teks yang mirip maknanya akan punya
    embedding yang mirip nilainya.

  Ingest:
    Proses memasukkan dokumen ke sistem: baca file â†’ pecah jadi
    potongan kecil (chunks) â†’ ubah jadi embedding â†’ simpan ke ChromaDB.

  Prompt:
    Instruksi yang diberikan ke LLM. Seperti "brief" yang menjelaskan
    siapa dia, apa yang harus dilakukan, dan bagaimana format jawabannya.

  State Machine:
    Sistem yang "ingat" posisi user saat ini. Seperti form multi-step:
    step 1 â†’ step 2 â†’ step 3. Backend harus tahu user ada di step mana.

  Graceful Degradation:
    Sistem yang tetap berfungsi walau kondisi tidak ideal. Kalau data
    lengkap â†’ hasil sempurna. Kalau data kurang â†’ hasil seadanya tapi
    tetap berguna.

  Endpoint:
    URL yang bisa diakses oleh frontend untuk mengirim/menerima data.
    Contoh: POST /api/chat/ adalah endpoint untuk mengirim pesan.

  Service Layer:
    Lapisan kode yang berisi logika bisnis. Terpisah dari HTTP handling
    (views) dan database (models). Ini supaya kode rapi dan testable.

  Inertia.js:
    Library yang menghubungkan Django (backend) dengan React (frontend)
    tanpa perlu bikin API terpisah untuk rendering halaman.

  Django Session:
    Cara Django menyimpan data per user di server. Seperti "memori
    sementara" yang hidup selama user login. Dipakai untuk simpan
    state planner.

  Knowledge Base:
    Kumpulan dokumen yang sudah di-upload dan di-embed user.
    Ini "memori" AI tentang data akademik user.

  Token (LLM context):
    Satuan teks yang diproses LLM. Kira-kira 1 token = 0.75 kata.
    Semakin banyak token, semakin mahal (uang) dan lambat.

  Fallback:
    Rencana cadangan. Kalau model AI pertama gagal, otomatis coba
    model kedua. Kalau filter terlalu ketat, coba tanpa filter.

================================================================================
END OF DOCUMENT
================================================================================

Disusun berdasarkan diskusi product planning arah.ai, 18 Februari 2026.
Referensi: Product Profile arah.ai (Untitled design.pdf), codebase
academic_rag_project (GitHub: Afyuadriputra/academic_rag_project).
